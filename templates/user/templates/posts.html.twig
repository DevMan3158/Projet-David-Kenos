<section id="container_posts">

    {# On conditionne la route pour afficher le H1 sur les profils #}

    {% if app.request.get('_route') == 'app_profil' %}

    <h1>
        Les derniers <span>posts publiés.</span>
    </h1>

    {% endif %}

    {% if post is not empty %}

    {# On Boucle les posts liés à l'utilisateur recherché OU de tous les utilisateurs si vous êtes sur la vie des
    chocolaterie #}

    {% for posts in post %}

    {{ posts.id }}
    <article class="posts">

        <div class="etiquette">
            {{ posts.catpost.nom }}
        </div>

        <figure>

            <img src="../{{ posts.user.imageprofil }}" alt="{{ posts.user.imageprofilalt }}">

        </figure>


        <div class="contenues">

            <h3>
                <span>
                    {{ posts.user.prenom}}
                </span>

                {{ posts.user.nom }}

                <p class="colorP">
                    publiés le {{ posts.createdAt|date('d/m/Y') }}
                </p>
            </h3>

            <div id="contenues_img">
                <img src="../{{ posts.imagepost }}" alt="{{ posts.imagepostalt }}">
            </div>


            <p>
                {{ posts.contenu }}
            </p>

            <div class="comments">

                {{ posts.commentaires|length }}

                <i class="fa-regular fa-comments">
                    <a href="#" id="commentaire" onClick="openMenu()">
                        Commenter
                    </a>
                </i>

                {{ posts.likes|length }}

                <i class="fa-regular fa-heart">
                    <a href="#">
                        J'aime
                    </a>
                </i>


            </div>

        </div>


    </article>

    {#Condition Soyer le premier à commenter ! commentaire différent suivant user, nom d'user dans com? et heure date#}



    {#///////////////////////Templates-Commentaires////////////////////#}


    <div id="container_com">

        {#///////////////////////Formulaire-Commentaire////////////////////#}

{#{% for contenulField in form %}
    
        {{ form_start(form) }}

        {{ form_row(form.contenu) }}

        <button class="btn">{{ button_label|default('Publier') }}</button>

        {{ form_end(form) }}
        
{% endfor %}#}
  
 {{ form_start(form) }}

        <textarea type="textarea" id="commentaire" name="commentaire" required minlength="2" maxlength="400" size="10" placeholder="Écrivez votre commentaire..."></textarea>

        <button id="CloseCom" onClick="closeMenu()">Publier</button>
        
{{ form_end(form) }}
        <h3>Les commentaires existants</h3>

        {# Ici on boucle les commentaires du post en question #}

        {% for comment in posts.commentaires %}      

        {# Ici on conditionne nos commentaires afin de les placer à droite s'ils ont été postés par l'utilisateur
        connecté #}

        {% if comment.user.id == app.user.id %}

        <div class="commentaire_box"></div>

        <div class="com_box_droite">

            <div class="commentaire2">

                <figure>
                    <a href="{{ path('app_profil', {'id':comment.user.id}) }}"><img
                            src="../../{{ app.user.imageprofil }}" alt="{{ app.user.imageprofilalt }}"></a>
                </figure>

                <div class="contenu">
                    <a href="{{ path('app_profil', {'id': user.id}) }}">
                        <p><span>{{ comment.user.prenom}}</span> {{ comment.user.nom }} :</p>
                    </a>

                    <br>
                    <p>{{ comment.contenu }}</p>
                    <br>

                    <p><strong>le {{ comment.createdAt|date('d/m/Y') }}</strong></p>
                    {#{{include('commentaire/_delete_form.html.twig') }}#}
                </div>


            </div>

        </div>

        {# Ou à gauche s'ils ont été postés par n'importe quel autre utilisateur. #}

        {% else %}

        <div class="com_box">

            <div class="commentaire">
                <figure>
                    <a href="{{ path('app_profil', {'id':comment.user.id}) }}"><img
                            src="../../{{ comment.user.imageprofil }}" alt="{{ comment.user.imageprofilalt }}"></a>
                </figure>
                <div class="contenu">
                    <a href="{{ path('app_profil', {'id':comment.user.id}) }}">
                        <p>{{ comment.user.prenom}} {{ comment.user.nom }} :</p>
                    </a>

                    <br>
                    <p>{{ comment.contenu }}</p>
                    <br>

                    <p><strong>le {{ comment.createdAt|date('d/m/Y') }}</strong></p>
                </div>
            </div>

        </div>

        {% endif %}

        {% endfor %}

    </div>

    {% endfor %}



    {% else %}

    <p>Vous n'avez pas de post publiés</span></p>

    {% endif %}

</section>

